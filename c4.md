## C.4. So sánh, ưu – nhược điểm và trade-off

Phần này tổng hợp và đối chiếu ba họ kỹ thuật chính đã trình bày:

- **Progressive Download** (mục C.1)  
- **HTTP Adaptive Streaming (ABR: DASH/HLS/CMAF)** (mục C.2)  
- **Real-time Streaming (RTP/WebRTC/RTMP)** (mục C.3)  

Trọng tâm là:

- So sánh kiến trúc, QoE, khả năng mở rộng.  
- Phân tích trade-off giữa **$latency$ – $quality$ – $stability$**.  
- Minh họa các kiến trúc triển khai điển hình bằng sơ đồ ASCII.

---

### C.4.1. Progressive Download vs ABR vs Real-time Streaming

Bảng so sánh tổng hợp (vo_d = VoD, LT = Live/Real-time):

```text
+----------------------+--------------------------+------------------------------+----------------------------+
| Tiêu chí             | Progressive Download     | HTTP ABR (DASH/HLS/CMAF)     | Real-time (RTP/WebRTC)     |
+----------------------+--------------------------+------------------------------+----------------------------+
| Kiểu dịch vụ         | Chủ yếu VoD             | VoD + Live OTT               | Calls, conf, gaming, live  |
|                      |                          |                              | interactive                |
+----------------------+--------------------------+------------------------------+----------------------------+
| Đơn vị truyền        | Toàn bộ file .mp4       | Segment/Chunk (2–6 s,        | Gói RTP (20–60 ms)         |
|                      |                          | 200–500 ms)                  |                            |
+----------------------+--------------------------+------------------------------+----------------------------+
| Điều chỉnh bitrate   | Không (bitrate cố định) | Có (per-segment, ABR)        | Có (sender-side rate ctrl) |
+----------------------+--------------------------+------------------------------+----------------------------+
| Giao thức nền        | HTTP/1.1, TCP           | HTTP/1.1/2/3 (QUIC), TCP     | UDP (RTP/SRTP), đôi khi    |
|                      |                          |                              | TCP (RTMP)                 |
+----------------------+--------------------------+------------------------------+----------------------------+
| Manifest             | Không                    | MPD (DASH), M3U8 (HLS)       | SDP (mô tả session),       |
|                      |                          |                              | signaling riêng            |
+----------------------+--------------------------+------------------------------+----------------------------+
| Latency điển hình    | VoD: không critical;    | VoD: vài giây startup;       | Calls: 100–300 ms;         |
|                      | Live: khó tối ưu        | Live: 2–6 s (LL: ~1–3 s)     | Live streaming: 0.5–2 s    |
+----------------------+--------------------------+------------------------------+----------------------------+
| Stall/Rebuffer       | Cao nếu $C < R_{enc}$   | Thấp (nếu ABR tốt, buffer    | Không “stall” theo nghĩa   |
|                      |                          | đủ lớn)                      | HTTP, nhưng có freeze/     |
|                      |                          |                              | frame drop                 |
+----------------------+--------------------------+------------------------------+----------------------------+
| Stability bitrate    | Không đổi               | Biến thiên theo mạng         | Thay đổi bitrate, frame-   |
|                      |                          | (switching)                  | rate, packet size          |
+----------------------+--------------------------+------------------------------+----------------------------+
| QoE control          | Hạn chế (bitrate fix)   | Linh hoạt (ABR + QoE model)  | Rất nhạy với jitter/loss   |
+----------------------+--------------------------+------------------------------+----------------------------+
| Scale với CDN        | Tốt (static file)       | Rất tốt (segment cache)      | RTMP: có, WebRTC: khó      |
+----------------------+--------------------------+------------------------------+----------------------------+
| Tương tác (interact.)| Kém                     | Tương tác hạn chế (delay s)  | Tốt (RTC, chat, game)      |
+----------------------+--------------------------+------------------------------+----------------------------+
```

#### C.4.1.1. Góc nhìn toán học về “độ thích nghi”

Gọi:

* $R_{enc}$ – bitrate mã hóa cố định trong progressive;
* ${R^{(m)}}$ – tập bitrate ABR;
* $C(t)$ – throughput mạng theo thời gian;
* $f_{PL}(t)$ – xác suất stall (progressive) hoặc freeze (real-time) tại thời điểm $t$.

**Progressive download:**

* điều kiện để **không stall** với throughput không đổi $C$:

  $$
  C \ge R_{enc}.
  $$

Khi $C(t)$ biến động, xác suất stall tăng nhanh khi $C(t) < R_{enc}$ trong một khoảng đủ dài để làm $B(t) \to 0$ (mục C.1). Không có cơ chế giảm $R_{enc}$ động.

**ABR:**

* thuật toán chọn $R_k$ sao cho:

  $$
  R_k \approx \gamma \hat{C}_k,
  \quad 0 < \gamma < 1,
  $$

* kết hợp với buffer:

  $$
  B_{k+1} = \max{0, B_k - D_k} + T_{seg},
  \quad
  D_k = \frac{R_k T_{seg}}{C_k}.
  $$

Nhờ đó, khi $C_k$ giảm, ABR có thể **giảm $R_k$** để duy trì $B_k$ > 0, giảm $f_{PL}(t)$.

**Real-time (WebRTC/RTP):**

* sender điều chỉnh sending rate $x_k$ sao cho:

  $$
  x_{k+1} =
  \begin{cases}
  x_k + \Delta_{up}, & \text{underuse (delay nhỏ)} \
  \beta x_k,         & \text{overuse (delay tăng)} \
  x_k,               & \text{otherwise},
  \end{cases}
  $$

* và đặt bitrate video $R_k \le x_k$.

Tức là real-time streaming áp dụng **congestion control liên tục** (GCC, SCReAM, NADA…), nhằm giữ delay và loss trong giới hạn, chấp nhận đánh đổi chất lượng (bitrate, framerate) để duy trì **tính thời gian thực**.

---

### C.4.2. Trade-off giữa Latency – Video Quality – Stability

Ta coi QoE là hàm của ba nhóm yếu tố:

* **$Q$** – chất lượng video (bitrate, resolution, metric khách quan như VMAF).
* **$L$** – latency (startup delay, end-to-end delay).
* **$S$** – stability (rebuffering/stall, mức độ biến động bitrate).

#### C.4.2.1. Mô hình QoE ba thành phần

Ta dùng một dạng hàm QoE tổng quát cho phiên $K$ segment (mở rộng từ C.2.5.3):

* $Q_k$ – chất lượng (có thể là VMAF hoặc $R_k$),
* $L_{start}$ – startup delay,
* $T_{stall, total}$ – tổng thời gian stall,
* $\Delta Q_k = |Q_{k+1} - Q_k|$ – mức switching chất lượng.

Một mô hình:

$$QoE = \underbrace{\sum_{k=1}^{K} u(Q_k)}_{\text{chất lượng trung bình}} - \underbrace{\alpha_T T_{stall,total}}_{\text{ổn định buffer (stall)}} - \underbrace{\alpha_S \sum_{k=1}^{K-1} \Delta Q_k}_{\text{ổn định chất lượng}} - \underbrace{\alpha_L L_{start}}_{\text{latency (startup)}}$$


trong đó:

* $u(\cdot)$ – hàm utility concave (ví dụ $u(Q) = \log Q$ hoặc $u(Q) \propto \text{VMAF}$), đảm bảo “diminishing returns” khi tăng bitrate;
* $\alpha_T$, $\alpha_S$, $\alpha_L$ – hệ số “phạt” cho từng loại sự cố; nghiên cứu user study cho thấy **một giây stall** có thể tệ hơn **vài chục giây chất lượng thấp hơn** [C16], [C17].

**Trade-off**:

* Tăng $Q_k$ (chọn $R_k$ cao) → tăng $u(Q_k)$ nhưng cũng tăng nguy cơ:

  * stall: $T_{stall,total} \uparrow$ (do $D_k$ dài hơn với cùng $C_k$),
  * switching: khi mạng biến động, phải hạ bitrate nhiều.

* Giảm $L_{start}$ (bắt đầu phát nhanh):

  * giảm $L_{start}$,
  * nhưng buffer khởi tạo $B_{start}$ nhỏ → dễ stall ở những segment đầu → $T_{stall,total} \uparrow$.

#### C.4.2.2. Không có “free lunch”: đường cong Pareto

Ta có thể hình dung **không gian giải pháp** $(Q, L, S)$ và **tập Pareto**:

* Một cấu hình $(Q_1, L_1, S_1)$ **ưu thế hơn** $(Q_2, L_2, S_2)$ nếu:

  * $Q_1 \ge Q_2$, $L_1 \le L_2$, $S_1 \ge S_2$
  * và ít nhất một bất đẳng thức nghiêm.

* Khi **không thể cải thiện một tiêu chí** mà không làm xấu đi tiêu chí khác, ta ở trên **biên Pareto**.

Ví dụ (VoD):

* Cấu hình A:

  * $L_{start} = 1\ \text{s}$; bitrate trung bình $R = 2\ \text{Mbit/s}$,
  * stall: $1$ s tổng cộng.

* Cấu hình B:

  * $L_{start} = 4\ \text{s}$; bitrate trung bình $R = 4\ \text{Mbit/s}$,
  * stall: $0$.

Tùy trọng số $\alpha_L, \alpha_T, \alpha_S$, người dùng có thể thích A hoặc B. Nhiều nghiên cứu chỉ ra:

* người dùng thường **ghét stall hơn** là chất lượng thấp một chút;
* nhưng cũng không chấp nhận latency/startup quá lớn trong interactive/live.

#### C.4.2.3. Ví dụ định lượng đơn giản

Giả sử ta muốn chọn $B_{start}$ (buffer khởi tạo) và bitrate cố định $R$ cho VoD (progressive hoặc ABR “fixed”):

* với $\hat{C}$ là throughput trung bình (tương đối ổn định);
* $L_{start} = \frac{R B_{start}}{\hat{C}}$ (từ C.1.4).

Nếu giả thiết (rất đơn giản):

* xác suất stall trong suốt phiên xấp xỉ:

  $$
  P_{stall} \approx \exp\left(-\kappa B_{start}\right)
  $$

với $\kappa > 0$, phản ánh việc buffer lớn hơn giúp “chống” jitter/loss tốt hơn.

QoE kỳ vọng:

$$E[\text{QoE}] \approx U(R) - \alpha_L \frac{R B_{start}}{\hat{C}} - \alpha_T T_{video} P_{stall}(B_{start})$$

trong đó:

* $U(R)$ – utility phụ thuộc bitrate,
* $T_{video}$ – thời lượng video.

Ta thấy:

* Tăng $B_{start}$:

  * Term $-\alpha_L \frac{R B_{start}}{\hat{C}}$ **giảm QoE** (latency lớn hơn);
  * Term $-\alpha_T T_{video} e^{-\kappa B_{start}}$ **tăng QoE** (vì $P_{stall}$ giảm).

Bài toán tối ưu $B_{start}$ là điển hình cho trade-off *latency vs stall*. Trong ABR, bài toán còn phức tạp hơn vì $R_k$ cũng là biến điều khiển.

#### C.4.2.4. So sánh trade-off theo từng họ kỹ thuật

1. **Progressive Download**

   * Latency:

     * $L_{start}$ có thể điều chỉnh bằng $B_{start}$, nhưng không có low-latency live thực sự;
     * không điều khiển $L_{\text{E2E}}$ trong live.

   * Quality:

     * cố định $R_{enc}$, không thể thích ứng;
     * để tránh stall trên mạng yếu → phải encode ở $R_{enc}$ thấp.

   * Stability:

     * bitrate **ổn định tuyệt đối** (không switching);
     * stall có thể rất nhiều nếu $C(t)$ < $R_{enc}$.

2. **HTTP ABR (DASH/HLS/CMAF)**

   * Latency:

     * VoD: chủ yếu là $L_{start}$ → có thể 1–5 s;
     * Live OTT: tuỳ design (HLS classic 10–30 s, LL-HLS/LL-DASH 2–6 s).

   * Quality:

     * đa bitrate → có thể chọn $R_k$ cao nhất phù hợp với $\hat{C}_k$;
     * dùng metrics như VMAF để thiết kế bitrate ladder tối ưu.

   * Stability:

     * stall ít nếu ABR tốt, buffer đủ;
     * switching bitrate được “làm mượt” bằng thuật toán (RB+BB+MPC/BOLA).

3. **Real-time (WebRTC/RTP)**

   * Latency:

     * mục tiêu $T_{\text{E2E}} \le 200$–$500$ ms cho calls/gaming;
     * jitter buffer nhỏ, không thể dùng buffer lớn để chống mọi biến động.

   * Quality:

     * thường **dưới** chất lượng VoD/OTT cùng băng thông, vì ưu tiên low-latency;
     * khi mạng xấu:

       * giảm $R_k$ mạnh,
       * giảm framerate,
       * tăng error concealment.

   * Stability:

     * không có stall kiểu “buffering”, nhưng có thể:

       * freeze 1–2 frame,
       * mosaic/blocking do packet loss,
       * out-of-sync A/V nếu jitter vượt ngưỡng.

---

### C.4.3. Các kiến trúc triển khai điển hình (ASCII)

Để minh hoạ trực quan, ta trình bày một số kiến trúc phổ biến cho ba lớp kỹ thuật.

#### C.4.3.1. Progressive Download trên Web/CDN

```text
   +---------------------+          +---------------------+
   |   Content Provider  |          |  Origin Web Server  |
   |  (Upload video.mp4) |   PUT    | (video.mp4 static)  |
   +----------+----------+--------->+----------+----------+
              |                               |
              |                    +----------+----------+
              |                    |     CDN / Cache     |
              |                    +----------+----------+
              |                               |
              |                       (HTTP GET /video.mp4)
              |                               |
       +------+-------------------------------+------+
       |              End-user Clients               |
       |  Browser / App (HTML5 <video> progressive)  |
       +---------------------------------------------+
```

Đặc điểm:

* File `.mp4` tĩnh;
* CDN cache toàn bộ file;
* Client chỉ có một URL và một bitrate.

#### C.4.3.2. HTTP ABR với DASH/HLS/CMAF + CDN

```text
  Offline Encoding & Packaging
  ----------------------------
   +---------------------+
   |  Encoder/Packager   |
   |  - Encode multi-bitrate
   |  - Cut into segments
   |  - Generate MPD/M3U8
   +----------+----------+
              |
              v
      +-------+-----------+
      |   Origin Server   |
      |  MPD/M3U8 + CMAF  |
      |  Segments (.m4s)  |
      +-------+-----------+
              |
          (CDN Pull/Push)
              v
      +-------+-----------+
      |       CDN         |
      | Edge Cache Nodes  |
      +---+-----------+---+
          |           |
   HTTP   |           |   HTTP
 GET      |           |   GET
          v           v
   +------+--+   +----+------+
   | Client |   |   Client   |
   | DASH   |   |   HLS      |
   +--------+   +------------+
         \          /
          \        /
      (ABR logic f_ABR)
   chọn $R_k$ per segment
```

Đặc điểm:

* Segment (CMAF) dùng chung cho DASH và HLS;
* CDN cache từng segment;
* Client tự chạy ABR để quyết định bitrate $R_k$.

#### C.4.3.3. Real-time WebRTC với SFU (Selective Forwarding Unit)

Đối với video conference nhiều bên, kiến trúc **SFU** thường dùng:

```text
                   +--------------------------+
                   |          SFU            |
                   | (Selective Forwarder)   |
                   +-----+----------+--------+
                         ^          ^
             WebRTC RTP  |          | WebRTC RTP
               Streams   |          | Streams
                         |          |
   +---------------------+          +----------------------+
   |   Client A (browser)           |  Client B (browser)  |
   |   - Capture, encode            |  - Capture, encode   |
   |   - WebRTC (ICE, DTLS-SRTP)    |  - WebRTC stack      |
   +--------------------------------+----------------------+

   +-------------------------------------------------------+
   |                  Client C, D, ...                     |
   |                (join same SFU room)                   |
   +-------------------------------------------------------+
```

* Mỗi client:

  * gửi **uplink** stream của mình lên SFU;
  * nhận **downlink** stream của các peer khác (đã được SFU chọn hoặc downsample).

* SFU:

  * không decode/encode (thường) → chỉ forward;
  * có thể thực hiện:

    * chọn layer (SVC/Simulcast) phù hợp với mỗi client,
    * drop frame/gói khi cần.

Trade-off:

* Latency rất thấp (sub-300 ms) nếu mạng tốt;
* Chất lượng phụ thuộc mạnh vào uplink/downlink từng client;
* Không tận dụng được cache/CDN ở mức độ như ABR VoD.

---

### Kết nối tới các phần sau

Các so sánh và mô hình trade-off ở C.4 là cơ sở để:

* Trong **phần D**, ta phân tích sâu hơn:

  * mô hình jitter RTP (D.1);
  * buffer occupancy và anti-stall (D.2, D.5);
  * mô hình QoE (D.3);
  * congestion control (D.4);
  * trade-off $latency$–$quality$–$stability$ (D.6).

* Trong **phần E**, ta thiết kế và chạy mô phỏng:

  * so sánh progressive vs ABR;
  * so sánh các thuật toán ABR (RB, BB, BOLA, MPC, Pensieve) dưới cùng trace mạng;
  * đánh giá định lượng QoE theo các thành phần $Q$, $L$, $S$.

---

### Tài liệu tham khảo cho mục C.4 (định dạng IEEE)

[C41] T.-Y. Huang *et al.*, “A buffer-based approach to rate adaptation: Evidence from a large video streaming service,” in *Proc. ACM SIGCOMM*, 2014, pp. 187–198.

[C42] X. Yin, A. Jindal, V. Sekar, and B. Sinopoli, “A control-theoretic approach for dynamic adaptive video streaming over HTTP,” in *Proc. ACM SIGCOMM*, 2015, pp. 325–338.

[C43] K. Spiteri, R. Urgaonkar, and R. K. Sitaraman, “BOLA: Near-optimal bitrate adaptation for online videos,” in *Proc. IEEE INFOCOM*, 2016, pp. 1–9.

[C44] H. Mao, R. Netravali, and M. Alizadeh, “Neural adaptive video streaming with Pensieve,” in *Proc. ACM SIGCOMM*, 2017, pp. 197–210.

[C45] H. Schulzrinne, S. Casner, R. Frederick, and V. Jacobson, “RTP: A Transport Protocol for Real-Time Applications,” RFC 3550, IETF, Jul. 2003.

[C46] H. Alvestrand, “Overview: Real-Time Protocols for Browser-Based Applications,” RFC 8825, IETF, Jan. 2021.

[C47] R. S. Begen, T. Akgul, and M. Baugher, “Watching video over the Web: Part 1: Streaming protocols,” *IEEE Internet Comput.*, vol. 15, no. 2, pp. 54–63, Mar.–Apr. 2011.

[C48] S. Petrangeli, J. Famaey, S. Latré, and F. De Turck, “QoE-driven rate adaptation heuristics for HTTP adaptive streaming,” *ACM Trans. Multimedia Comput. Commun. Appl.*, vol. 12, no. 2, pp. 1–29, 2015.

[C49] T. Mangla *et al.*, “Internet-scale video streaming: A view from the edge,” in *Proc. ACM CoNEXT*, 2018, pp. 1–14.

[C50] A. Håkansson *et al.*, “Understanding Low-Latency Video Streaming: A Study of Commercial Services and Industry Standards,” in *Proc. ACM MMSys*, 2023.

