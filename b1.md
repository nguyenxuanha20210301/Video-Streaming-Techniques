## B.1. Nén video và các chuẩn mã hóa

### B.1.0. Khung lý thuyết chung về nén video

Nén video nhằm giảm bitrate cần thiết để truyền và lưu trữ dãy ảnh động nhưng vẫn duy trì chất lượng cảm nhận ở mức chấp nhận được. Xét một tín hiệu video số có độ phân giải \(W \times H\), tần số khung hình \(f\) (fps), lấy mẫu màu 4:2:0 với độ sâu 8 bit mỗi thành phần. Bitrate thô (chưa nén) xấp xỉ:

$$
R_{\text{raw}} 
= W \cdot H \cdot f \cdot b_{\text{pp}}
$$

với \(b_{\text{pp}}\) là số bit trung bình trên mỗi điểm ảnh (pixel). Đối với mẫu 4:2:0 8-bit:

- 1 mặt phẳng độ chói (Y): 8 bit/pixel  
- 2 mặt phẳng màu (Cb, Cr) nhưng lấy mẫu thưa hơn 4:2:0 → trung bình 4 bit/pixel  

Do đó:

$$
b_{\text{pp}} \approx 12\ \text{bit/pixel}
$$

Ví dụ với video Full HD \(1920 \times 1080\), \(f = 25\ \text{fps}\):

$$
R_{\text{raw}} 
= 1920 \cdot 1080 \cdot 25 \cdot 12 
\approx 6.22 \times 10^8\ \text{bit/s} 
\approx 622\ \text{Mbit/s}
$$

Bitrate này vượt xa khả năng băng thông của hầu hết hệ thống truyền thông, do đó cần nén video với tỉ lệ hàng chục đến hàng trăm lần.

Các chuẩn video hiện đại như H.264/AVC, H.265/HEVC, AV1 đều dựa trên cùng một kiến trúc **hybrid block-based video coding** (mã hóa lai khối) gồm các khối chức năng chính: dự đoán (intra/inter), tính sai số dự đoán (residual), biến đổi (transform), lượng tử hóa (quantization), mã hóa entropy và bộ lọc trong vòng lặp (in-loop filtering) \[B1–B3, B6–B9].

Ở mức trừu tượng, tại khung hình thứ \(t\), ta ký hiệu:

- \(\mathbf{X}_t\): ma trận pixel của khung cần mã hóa  
- \(\hat{\mathbf{P}}_t\): khung dự đoán (từ nội suy không gian hoặc bù chuyển động từ khung tham chiếu)  
- \(\mathbf{E}_t\): khung sai số (residual)

Mối quan hệ:

$$
\mathbf{E}_t = \mathbf{X}_t - \hat{\mathbf{P}}_t
$$

Sai số \(\mathbf{E}_t\) được chia thành các **khối** (block), thường có kích thước \(N \times N\), sau đó được biến đổi (gần với DCT):

$$
\mathbf{Y} = \mathbf{T} \, \mathbf{E}_t \, \mathbf{T}^\top
$$

với \(\mathbf{T}\) là ma trận biến đổi trực giao (hoặc gần trực giao). Sau biến đổi, các hệ số \(\mathbf{Y}\) được lượng tử hóa:

$$
\mathbf{\hat{Y}} = Q_\Delta(\mathbf{Y})
$$

Trong đó \(Q_\Delta(\cdot)\) là toán tử lượng tử hóa với bước lượng tử \(\Delta\) (hoặc thông qua tham số QP – Quantization Parameter). Các hệ số lượng tử hóa \(\mathbf{\hat{Y}}\) được quét và đưa vào bộ mã hóa entropy (CAVLC, CABAC, context-adaptive binary/range coding, v.v.).

Kiến trúc mã hóa hiện đại thường được tối ưu dưới góc nhìn **tối ưu hóa tỉ lệ–méo (rate–distortion, RD)**. Với một lựa chọn chế độ mã hóa (mode) \(m\) và mức lượng tử \(q\), bộ mã hóa giải bài toán:

$$
(m^\star, q^\star) 
= \arg \min_{m, q} \left[ D(m, q) + \lambda R(m, q) \right]
$$

trong đó:

- \(D(m, q)\): méo (distortion) – thường đo bằng MSE hoặc PSNR;  
- \(R(m, q)\): bitrate xấp xỉ (số bit ước lượng);  
- \(\lambda\): hệ số Lagrange điều chỉnh trade-off giữa chất lượng và bitrate.

Mô hình \(J = D + \lambda R\) là nền tảng cho hầu hết quyết định nội bộ của bộ mã hóa H.264, H.265 và AV1 (lựa chọn mode, kích thước khối, vector chuyển động, v.v.) \[B3, B6–B8, B10].

Ở phía giải mã, video được tái tạo bằng cách áp dụng biến đổi ngược, khử lượng tử, cộng với khung dự đoán, sau đó qua các bộ lọc trong vòng (ví dụ deblocking, SAO, CDEF, loop restoration) để giảm các hiện tượng khối (blocking) và nhiễu lượng tử.

---

### B.1.1. H.264/AVC (ISO/IEC 14496-10, ITU-T H.264)

#### B.1.1.1. Mục tiêu và phạm vi chuẩn

H.264/AVC là chuẩn mã hóa video của nhóm ITU-T VCEG và ISO/IEC MPEG, được công bố khoảng năm 2003 với mục tiêu chính là:

- cải thiện rõ rệt hiệu năng nén (rate–distortion) so với MPEG-2 và H.263;  
- cung cấp cú pháp bitstream **“network-friendly”** để phù hợp với truyền hình, lưu trữ, truyền qua IP, thoại hình, streaming, v.v. \[B1–B3].

Chuẩn này được đồng xuất bản dưới tên **ITU-T Rec. H.264** và **ISO/IEC 14496-10 Advanced Video Coding (AVC)** \[B1, B2].

#### B.1.1.2. Cấu trúc lớp cú pháp: VCL và NAL

H.264/AVC định nghĩa hai lớp chính:

- **Video Coding Layer (VCL)**: mô tả nội dung video dưới dạng các slice/sub-slice chứa macroblock và các thông tin dự đoán, biến đổi, lượng tử hóa.  
- **Network Abstraction Layer (NAL)**: đóng gói VCL và các thông tin điều khiển (SEI, SPS, PPS) thành các NAL unit, thích nghi với các môi trường truyền dẫn khác nhau (RTP/UDP, MP4, TS…).  

NAL cho phép gắn cờ ưu tiên, phân mảnh, ghép các loại dữ liệu khác nhau thuận tiện cho streaming \[B3].

#### B.1.1.3. Macroblock, slice và cấu trúc khối

Trong H.264, mỗi khung (frame) hoặc field được chia thành các **macroblock (MB)** kích thước 16×16 mẫu luma (và tương ứng chroma). Mỗi MB có thể được chia nhỏ hơn (sub-macroblock) để mô hình hóa chuyển động chi tiết:

- Khối dự đoán chuyển động: 16×16, 16×8, 8×16, 8×8;  
- Các sub-MB 8×8 tiếp tục chia thành 8×4, 4×8, 4×4.

Các macroblock được tổ chức thành **slice** – một tập hợp MB liên tiếp trong raster scan. Slice có thể được giải mã độc lập, giúp tăng khả năng chống lỗi và song song hóa.

#### B.1.1.4. Dự đoán intra và inter

**Dự đoán intra (nội khung):** H.264 sử dụng nhiều mode dự đoán theo hướng (directional prediction) cho các khối 4×4, 8×8 hoặc 16×16. Pixel của khối hiện tại được ước lượng từ các pixel đã được giải mã ở biên trên và bên trái \[B3, B10].

**Dự đoán inter (bù chuyển động):**

- Sử dụng **motion vector (MV)** với độ phân giải tới 1/4 pixel.  
- Inter prediction có thể dùng nhiều khung tham chiếu (multiple reference frames) để tăng độ linh hoạt.  
- Mode B-slice cho phép dùng **bi-prediction** (kết hợp hai khung tham chiếu, thường trước và sau khung hiện tại).

Về mặt toán học, với một block \(B\) tại vị trí \((x,y)\) của khung \(t\), sử dụng khung tham chiếu \(t'\) với vector chuyển động \(\mathbf{v} = (v_x, v_y)\), block dự đoán là:

$$
\hat{\mathbf{P}}_t(x,y) = \mathbf{X}_{t'}(x + v_x,\, y + v_y)
$$

Sai số dự đoán:

$$
\mathbf{E}_t(x,y) = \mathbf{X}_t(x,y) - \hat{\mathbf{P}}_t(x,y)
$$

**Lựa chọn mode** (intra/inter, kích thước khối, vector chuyển động) trong H.264 đều dựa trên tối ưu hóa rate–distortion với hàm chi phí Lagrange:

$$
J_{\text{mode}} = D_{\text{mode}} + \lambda_{\text{mode}} R_{\text{mode}}
$$

#### B.1.1.5. Biến đổi, lượng tử hóa và mã hóa entropy

H.264 sử dụng biến đổi integer 4×4 (và 8×8 ở High profile) gần với DCT để tận dụng tương quan không gian \[B3].

Cho một block 4×4 residual \(\mathbf{E}\), biến đổi:

$$
\mathbf{Y} = \mathbf{T}_4 \, \mathbf{E} \, \mathbf{T}_4^\top
$$

trong đó \(\mathbf{T}_4\) là ma trận biến đổi nguyên, được thiết kế sao cho:

- gần trực giao;  
- dễ hiện thực bằng phép dịch bit và cộng/trừ.

Lượng tử hóa áp dụng trên các hệ số \(\mathbf{Y}\) dựa trên **quantization step size** \(Q_{\text{step}}\) điều khiển bởi QP. H.264 định nghĩa quan hệ logarit giữa QP và \(Q_{\text{step}}\):

$$
Q_{\text{step}}(QP) \propto 2^{\frac{QP - 4}{6}}
$$

do đó cứ tăng QP 6 đơn vị thì \(Q_{\text{step}}\) tăng gấp đôi, dẫn tới giảm bitrate nhưng tăng méo.

Về **mã hóa entropy**, H.264 hỗ trợ hai cơ chế:

- **CAVLC** (Context-Adaptive Variable Length Coding): sử dụng mã biến độ dài, thích ứng theo ngữ cảnh số lượng hệ số khác không.  
- **CABAC** (Context-Adaptive Binary Arithmetic Coding): mã hóa số học nhị phân với mô hình ngữ cảnh, cho hiệu quả nén tốt hơn đáng kể nhưng phức tạp hơn \[B3].

#### B.1.1.6. Bộ lọc trong vòng (in-loop deblocking filter)

H.264 đưa vào **bộ lọc khử khối (deblocking filter)** trong vòng lặp, được áp dụng trên biên giữa các macroblock/khối sau khi giải mã và trước khi lưu vào bộ nhớ tham chiếu. Mục tiêu là:

- giảm hiện tượng khối (blocking artifacts) do lượng tử hóa mạnh;  
- cải thiện chất lượng cảm nhận;  
- đồng thời cải thiện hiệu quả dự đoán inter ở các khung sau \[B3].

Nhờ các kỹ thuật trên, H.264 đạt được cải thiện rate–distortion đáng kể, thường tiết kiệm khoảng 50% bitrate so với MPEG-2 cho cùng chất lượng PSNR \[B3].

---

### B.1.2. H.265/HEVC (ISO/IEC 23008-2, ITU-T H.265)

#### B.1.2.1. Mục tiêu hiệu năng và phạm vi

**High Efficiency Video Coding (HEVC)** – H.265 là chuẩn kế thừa H.264, do ITU-T VCEG và ISO/IEC MPEG cùng phát triển (JCT-VC), với mục tiêu **giảm khoảng 50% bitrate so với H.264/AVC cho chất lượng cảm nhận tương đương** \[B4–B6].

Chuẩn được xuất bản dưới dạng **ITU-T Rec. H.265** và **ISO/IEC 23008-2** \[B4, B5].

HEVC nhắm tới các ứng dụng:

- video độ phân giải rất cao (UHD 4K, 8K);  
- truyền hình số thế hệ mới;  
- streaming qua mạng IP băng thông hạn chế;  
- lưu trữ dung lượng lớn (Blu-ray UHD, VoD).

#### B.1.2.2. Cấu trúc CTU, CU, PU, TU (quadtree)

Khác với macroblock cố định 16×16 của H.264, HEVC sử dụng cấu trúc **Coding Tree Unit (CTU)** với kích thước tối đa 64×64. CTU được phân hoạch bởi cây tứ phân (quadtree) thành các **Coding Unit (CU)**, và tiếp tục chia thành:

- **Prediction Unit (PU):** định nghĩa hình dạng và kích thước khối dự đoán;  
- **Transform Unit (TU):** định nghĩa khối biến đổi residual.

Cấu trúc phân cấp có thể biểu diễn dưới dạng cây (ASCII):

    CTU (64x64)
    ├── CU (32x32)
    │   ├── CU (16x16)
    │   │   ├── ...
    │   └── ...
    └── CU (32x32)
        └── ...

Phân hoạch linh hoạt cho phép:

- dùng khối lớn ở vùng ít chi tiết/ít chuyển động để giảm overhead;  
- dùng khối nhỏ ở vùng có biên phức tạp hoặc chuyển động mạnh để cải thiện dự đoán.

#### B.1.2.3. Dự đoán intra và inter nâng cao

**Intra prediction:** HEVC mở rộng số lượng mode dự đoán intra lên đến 35 mode (33 directional + DC + planar), so với 9–13 mode của H.264, cho phép mô hình hóa hướng biên mịn hơn \[B6].

**Inter prediction:**

- Hỗ trợ motion vector với độ phân giải 1/4 hoặc 1/8 pixel;  
- Nhiều dạng chia khối chuyển động (symmetric/asymmetric motion partitions);  
- **Merge mode** cho phép thừa kế vector chuyển động từ lân cận, giảm số bit dùng để mã hóa MV;  
- **Advanced Motion Vector Prediction (AMVP)** khai thác ứng viên MV từ lân cận (spatial/temporal candidates).

Toán học bù chuyển động trong HEVC vẫn dựa trên công thức:

$$
\hat{\mathbf{P}}_t(\mathbf{b}) 
= \mathbf{X}_{t'}(\mathbf{b} + \mathbf{v})
$$

với \(\mathbf{b}\) là vector vị trí pixel trong block hiện tại, \(\mathbf{v}\) là motion vector của block.

#### B.1.2.4. Biến đổi, lượng tử hóa và bộ lọc

HEVC sử dụng biến đổi integer 2D kích thước từ 4×4 đến 32×32 cho các TU, dựa trên biến đổi cosine rời rạc (DCT) và biến đổi sin rời rạc (DST) cho một số block 4×4 trong intra prediction \[B6].

Cho block residual kích thước \(N \times N\):

$$
\mathbf{Y} = \mathbf{T}_N \, \mathbf{E} \, \mathbf{T}_N^\top,\quad N \in \{4, 8, 16, 32\}
$$

Lượng tử hóa vẫn dựa trên QP với quan hệ hàm mũ tương tự H.264, nhưng được điều khiển linh hoạt theo CU/TU và các yếu tố như QP offset theo slice, chroma QP mapping…

Về **in-loop filtering**, HEVC kết hợp:

- **Deblocking filter** (tương tự nhưng cải tiến so với H.264);  
- **Sample Adaptive Offset (SAO):** hiệu chỉnh mức mẫu dựa trên thống kê biên/độ sáng để giảm lỗi lượng tử hóa còn lại.

#### B.1.2.5. Mã hóa entropy: CABAC cải tiến

HEVC loại bỏ CAVLC, chỉ dùng **CABAC** với thiết kế cải tiến:

- số lượng ngữ cảnh tối ưu hơn;  
- tổ chức cú pháp thuận lợi hơn cho song song hóa (bộ mã hóa phần cứng);  
- giảm độ phức tạp so với CABAC của H.264 trong khi vẫn giữ hiệu quả.

Nhờ kết hợp các cơ chế trên, HEVC đạt mục tiêu **tiết kiệm khoảng 50% bitrate so với H.264/AVC** ở cùng chất lượng chủ quan, đặc biệt với nội dung HD/UHD \[B6].

---

### B.1.3. AV1 (AOMedia Video 1)

#### B.1.3.1. Bối cảnh và mục tiêu thiết kế

**AV1 (AOMedia Video 1)** là codec video mở, royalty-free do **Alliance for Open Media (AOMedia)** phát triển, được hoàn tất phiên bản 1.0 vào năm 2018. Mục tiêu chính:

- hiệu quả nén vượt trội so với VP9 và HEVC (thường báo cáo **gần 30% tiết kiệm bitrate so với VP9** cho cùng chất lượng);  
- miễn phí bản quyền sử dụng, khuyến khích triển khai rộng rãi trên web, streaming và thiết bị di động;  
- giữ độ phức tạp giải mã ở mức khả thi cho phần cứng \[B7–B9].

AV1 hiện được chuẩn hóa qua **AV1 Bitstream & Decoding Process Specification** do AOMedia công bố \[B7].

#### B.1.3.2. Cấu trúc block và phân vùng

Tương tự HEVC, AV1 sử dụng cấu trúc block phân cấp, nhưng linh hoạt hơn:

- **Superblock**: kích thước 64×64 hoặc 128×128;  
- Superblock được chia theo cây nhị phân, tứ phân, hoặc phân vùng không đều (rectangular, T-shaped) thành các khối nhỏ hơn;  
- Khối **Coding Unit** trong AV1 thường được gọi là **Coding Block (CB)** hoặc đơn giản là **block**.

AV1 cho phép kích thước block rất đa dạng, từ 4×4 đến 128×128, giúp thích ứng tốt với nội dung có cấu trúc không đồng nhất (vùng phẳng vs vùng chi tiết) \[B8, B9].

#### B.1.3.3. Dự đoán intra/inter nâng cao

**Intra prediction:**

- Hỗ trợ rất nhiều hướng (directional modes) với các kỹ thuật interpolation tinh vi;  
- Các mode đặc biệt như **smooth prediction** để xử lý vùng biến thiên chậm, **palette mode** cho nội dung ít màu (screen content).

**Inter prediction:**

- Hỗ trợ nhiều khung tham chiếu quá khứ và tương lai;  
- Phong phú các dạng hợp nhất (compound prediction): **wedge, difference-weighted, masked**, v.v.;  
- **Global motion** và **warp motion** cho phép mô hình hóa các biến đổi affine ở mức frame hoặc region;  
- Cơ chế phân tách chuyển động bất đối xứng, đa chế độ để khai thác chính xác chuyển động phức tạp \[B8, B9].

Toán học cho dự đoán affine/warped có thể viết:

$$
\begin{aligned}
\begin{bmatrix}
x' \\[4pt]
y'
\end{bmatrix}
&=
\mathbf{A}
\begin{bmatrix}
x \\[4pt]
y
\end{bmatrix}
+
\mathbf{b}
\end{aligned}
$$



trong đó \(\mathbf{A}\) là ma trận \(2 \times 2\) thể hiện quay, co giãn, shear; \(\mathbf{b}\) là vector tịnh tiến. Block dự đoán lấy mẫu tại \((x',y')\) trên khung tham chiếu.

#### B.1.3.4. Biến đổi, lượng tử hóa và lọc trong vòng

AV1 sử dụng họ **biến đổi 2D linh hoạt**:

- DCT-II, DCT-IV, ADST (Asymmetric DST) và một số biến đổi hỗn hợp (DCT/ADST theo chiều ngang/dọc);  
- Kích thước biến đổi từ 4×4 đến 64×64, bao gồm cả block chữ nhật (ví dụ 4×8, 8×4, 8×16…).

Các biến đổi này được lựa chọn dựa trên mode dự đoán và thống kê residual, nhằm tối ưu hóa nén theo hướng.

AV1 áp dụng nhiều bộ lọc trong vòng:

- **Deblocking filter** để xử lý biên khối;  
- **CDEF (Constrained Directional Enhancement Filter)** – lọc hướng để giảm nhiễu mà không làm mờ biên;  
- **Loop restoration filters** (Wiener, self-guided filter) để khôi phục chi tiết sau lượng tử hóa \[B8, B9].

#### B.1.3.5. Mã hóa entropy dựa trên range coding

Thay vì CABAC, AV1 dùng các biến thể **multi-symbol arithmetic/range coding** với ngữ cảnh phong phú:

- Các symbol (không nhất thiết nhị phân) được mã hóa theo phân bố xác suất được học thích ứng từ lịch sử bitstream;  
- Hỗ trợ **multi-symbol coding** giúp giảm số vòng lặp so với mã nhị phân thuần, thuận lợi cho hiện thực phần mềm tối ưu vector hóa.

Tương tự H.264/HEVC, nhiều quyết định trong AV1 (mode, kích cỡ block, vector chuyển động) cũng được tối ưu theo hàm chi phí rate–distortion \(J = D + \lambda R\), nhưng với tập công cụ lớn hơn và mô hình xác suất phong phú hơn, AV1 thường đạt độ dốc RD tốt hơn (đo qua BD-Rate) so với VP9/HEVC trong nhiều test set \[B8, B9].

---

### B.1.4. Các khái niệm cơ bản: frame, macroblock/CTU, prediction, transform, entropy coding

#### B.1.4.1. Frame, field và cấu trúc GOP

- **Frame (khung hình):** ảnh toàn phần tại thời điểm \(t\).  
- **Field:** trong video liên miền (interlaced), mỗi frame gồm hai field (odd/even lines).  
- **GOP (Group of Pictures):** chuỗi frame có cấu trúc lặp lại, ví dụ I-B-B-P…, sẽ được phân tích chi tiết ở mục B.2.

Ba loại frame cơ bản trong hầu hết chuẩn:

- **I-frame (Intra-coded):** mã hóa nội khung, là điểm khởi đầu cho dự đoán, hỗ trợ truy cập ngẫu nhiên.  
- **P-frame (Predictive-coded):** dự đoán từ các frame quá khứ (inter prediction).  
- **B-frame (Bi-predictive):** dự đoán từ cả quá khứ và tương lai.

Cấu trúc dự đoán giúp giảm mạnh bitrate do tận dụng tương quan thời gian giữa các frame \[B3, B6].

#### B.1.4.2. Macroblock và Coding Tree Unit (CTU)

- Trong **H.264**, đơn vị mã hóa cơ bản là **macroblock 16×16**.  
- Trong **HEVC**, đơn vị tương ứng là **CTU**, kích thước tới 64×64, phân rã theo quadtree thành CU/PU/TU.  
- Trong **AV1**, đơn vị lớn nhất là **superblock 64×64 hoặc 128×128**, tiếp tục chia linh hoạt thành block nhỏ hơn.

Các khối này là đơn vị:

- ra quyết định dự đoán (intra/inter, mode, vector chuyển động);  
- áp dụng biến đổi, lượng tử hóa;  
- mã hóa entropy \[B3, B6, B8].

#### B.1.4.3. Dự đoán (prediction)

- **Intra prediction:** khai thác tương quan không gian, dự đoán pixel trong khối từ lân cận đã giải mã.  
  Ví dụ đơn giản cho mode DC (trung bình):

  $$
  \hat{x}_{i,j} = \frac{1}{N_{\text{ref}}} \sum_{k \in \mathcal{N}} x_k
  $$

  với \(\mathcal{N}\) là tập các pixel tham chiếu (trên, trái, góc), \(N_{\text{ref}}\) là số phần tử trong \(\mathcal{N}\).

- **Inter prediction:** khai thác tương quan thời gian, sử dụng vector chuyển động để lấy mẫu từ khung tham chiếu.

  $$
  \hat{x}_t(\mathbf{p}) = x_{t'}(\mathbf{p} + \mathbf{v}(\mathbf{p}))
  $$

  trong đó \(\mathbf{p} = (x,y)\) là vị trí pixel, \(\mathbf{v}(\mathbf{p})\) là vector chuyển động.

Dự đoán tốt làm giảm năng lượng của residual, từ đó cải thiện hiệu quả biến đổi và lượng tử hóa.

#### B.1.4.4. Biến đổi (transform) và lượng tử hóa

Sau khi dự đoán, residual được biến đổi sang miền tần số (hoặc miền biến đổi) để gom năng lượng vào một số ít hệ số có biên độ lớn (low-frequency coefficients).

- H.264: transform integer 4×4 (và 8×8).  
- HEVC: transform integer 4×4 đến 32×32.  
- AV1: transform đa dạng (DCT, ADST, hỗn hợp) và kích thước tới 64×64.

Lượng tử hóa biến hệ số thực thành dạng rời rạc:

$$
\hat{y}_{i,j} = \text{round}\!\left( \frac{y_{i,j}}{Q_{\text{step}}} \right)
$$

Méo lượng tử (quantization distortion) thường được đo bằng MSE:

$$
\text{MSE} = \frac{1}{MN} \sum_{i=1}^{M} \sum_{j=1}^{N} \big(x_{i,j} - \hat{x}_{i,j}\big)^2
$$

và PSNR:

$$
\text{PSNR} = 10 \log_{10} \left( \frac{MAX^2}{\text{MSE}} \right)
$$

trong đó \(MAX = 255\) với 8-bit video.

#### B.1.4.5. Mã hóa entropy

Mục tiêu của mã hóa entropy là tiệm cận entropy Shannon của nguồn:

$$
H = - \sum_{k} p_k \log_2 p_k
$$

với \(p_k\) là xác suất ký hiệu \(k\).  

Các chuẩn hiện đại sử dụng:

- **H.264:** CAVLC (VL coding) và CABAC (arithmetic coding nhị phân thích ứng ngữ cảnh) \[B3].  
- **H.265:** CABAC cải tiến \[B6].  
- **AV1:** multi-symbol range coding/context-based arithmetic coding \[B8, B9].

Mô hình ngữ cảnh (context modeling) ước lượng \(p_k\) dựa trên lịch sử bitstream, giúp mã hóa ngắn hơn cho các pattern xuất hiện thường xuyên.

---

### B.1.5. Bảng so sánh tổng quan H.264/AVC – H.265/HEVC – AV1

| Đặc tính                     | H.264/AVC                         | H.265/HEVC                                   | AV1 (AOMedia Video 1)                                 |
|-----------------------------|-----------------------------------|----------------------------------------------|-------------------------------------------------------|
| Tổ chức tiêu chuẩn          | ITU-T H.264 / ISO/IEC 14496-10   | ITU-T H.265 / ISO/IEC 23008-2                | Alliance for Open Media (AOMedia)                     |
| Đơn vị lớn nhất             | Macroblock 16×16                  | CTU đến 64×64                                 | Superblock 64×64 / 128×128                            |
| Kích thước biến đổi tối đa  | 8×8                               | 32×32                                         | 64×64, nhiều dạng DCT/ADST                           |
| Mã hóa entropy              | CAVLC, CABAC                      | CABAC                                         | Range coding / multi-symbol AC                        |
| Bộ lọc trong vòng           | Deblocking                        | Deblocking + SAO                              | Deblocking + CDEF + Loop Restoration                  |
| Mục tiêu tiết kiệm bitrate  | so với MPEG-2                     | ~50% so với H.264/AVC                         | ~30% so với VP9, thường tốt hơn HEVC trong nhiều test |
| Tính bản quyền              | Nhiều pool patent                 | Nhiều pool patent                             | Thiết kế nhắm tới royalty-free                        |

(Các con số về tiết kiệm bitrate là giá trị điển hình được báo cáo trong tài liệu chuẩn và bài báo tổng quan, kết quả cụ thể tùy thuộc nội dung và cấu hình mã hóa) \[B3, B6, B8, B9].

---

### Tài liệu tham khảo cho mục B.1 (định dạng IEEE)

\[B1] ITU-T, *Recommendation H.264: Advanced Video Coding for Generic Audiovisual Services*, ITU-T Rec. H.264, 2003 và các phiên bản sửa đổi.  

\[B2] ISO/IEC, *Information Technology — Coding of Audio-Visual Objects — Part 10: Advanced Video Coding*, ISO/IEC 14496-10, 2022.  

\[B3] T. Wiegand, G. J. Sullivan, G. Bjøntegaard, and A. Luthra, “Overview of the H.264/AVC video coding standard,” *IEEE Trans. Circuits Syst. Video Technol.*, vol. 13, no. 7, pp. 560–576, Jul. 2003.  

\[B4] ITU-T, *Recommendation H.265: High Efficiency Video Coding*, ITU-T Rec. H.265, 2013 và các phiên bản sửa đổi.  

\[B5] ISO/IEC, *Information Technology — High Efficiency Coding and Media Delivery in Heterogeneous Environments — Part 2: High Efficiency Video Coding*, ISO/IEC 23008-2.  

\[B6] G. J. Sullivan, J.-R. Ohm, W.-J. Han, and T. Wiegand, “Overview of the High Efficiency Video Coding (HEVC) standard,” *IEEE Trans. Circuits Syst. Video Technol.*, vol. 22, no. 12, pp. 1649–1668, Dec. 2012.  

\[B7] Alliance for Open Media, *AV1 Bitstream & Decoding Process Specification*, AOMedia, 2018.  

\[B8] J. Han *et al.*, “A technical overview of AV1,” *Proc. IEEE*, vol. 109, no. 9, pp. 1435–1462, Sep. 2021.  

\[B9] Y. Chen *et al.*, “An overview of coding tools in AV1: The first video codec from the Alliance for Open Media,” *APSIPA Trans. Signal Inf. Process.*, vol. 9, e2, pp. 1–27, 2020.  

\[B10] Y. Wang, *Predictive Coding and Block-Based Hybrid Video Coding* (lecture notes), NYU Tandon School of Engineering.
