## B.5. Các chuẩn hóa kỹ thuật trong streaming

Các hệ thống video streaming hiện đại không chỉ dựa trên codec (H.264, H.265, AV1) mà còn phụ thuộc chặt chẽ vào **các chuẩn hóa hệ thống** ở tầng phân phối:

- **MPEG-DASH** (ISO/IEC 23009-1) – chuẩn hóa adaptive streaming trên HTTP;  
- **HTTP Live Streaming (HLS)** – chuẩn hóa bởi IETF trong RFC 8216;  
- **CMAF** (ISO/IEC 23000-19) – định dạng media chung cho segmented streaming;  
- Các **guidelines công nghiệp** (DASH-IF, Apple HLS Guidelines) – tinh chỉnh thực hành triển khai, profile tương thích.

Các chuẩn này đảm bảo rằng **player, encoder, CDN, packager** đến từ các vendor khác nhau vẫn có thể tương tác với nhau, đồng thời tối ưu cho:

- khả năng mở rộng trên hạ tầng HTTP/CDN;  
- hỗ trợ adaptive bitrate (ABR);  
- hỗ trợ DRM, phụ đề, multi-track, ad insertion.

---

### B.5.1. MPEG-DASH (ISO/IEC 23009-1)

#### B.5.1.1. Khái quát chuẩn MPEG-DASH

**Dynamic Adaptive Streaming over HTTP (DASH)**, còn gọi là **MPEG-DASH**, là bộ chuẩn của MPEG cho phép streaming đa phương tiện qua HTTP một cách thích ứng với điều kiện mạng \[B31–B33]. Chuẩn chính:

- **ISO/IEC 23009-1** – *Media Presentation Description and Segment Formats*, hiện bản mới là 23009-1:2022 \[B31, B32].  

MPEG-DASH định nghĩa:

- **MPD (Media Presentation Description)** – manifest mô tả cấu trúc nội dung;  
- **Segment formats** – cách tổ chức segment trên nền **ISO Base Media File Format** (ISOBMFF – ISO/IEC 14496-12) hoặc MPEG-2 TS \[B31];  
- Cú pháp và semantics cho việc **adaptive streaming** nhưng **không buộc** thuật toán ABR cụ thể.

DASH được thiết kế để làm việc tốt với **HTTP server/CDN hiện có**, không yêu cầu server “thông minh” đặc biệt – server chỉ cần phục vụ file tĩnh (MPD, segment).

#### B.5.1.2. Mô hình hệ thống trừu tượng

Chuẩn 23009-1 định nghĩa ba thành phần logic chính \[B31]:

- **DASH client**: tải MPD và các segment qua HTTP, thực hiện giải mã, scheduling, ABR.  
- **DASH encoder/packager**: tạo segment và MPD từ nội dung input.  
- **HTTP server/CDN**: lưu trữ và phân phối các file MPD/segment như object tĩnh.

Gọi:

- $R_k$: bitrate representation được chọn cho segment thứ $k$ (bit/s);  
- $T_{\text{seg}}$: độ dài thời gian của một segment (s);  
- $S_k$: kích thước segment thứ $k$ (bit), xấp xỉ $S_k \approx R_k \cdot T_{\text{seg}}$.

DASH **không quy định** $R_k$ được chọn thế nào; đây là nhiệm vụ của thuật toán ABR phía client (sẽ phân tích ở mục C.2.5–C.2.6).

#### B.5.1.3. Cấu trúc MPD: Period, AdaptationSet, Representation

MPD là một tài liệu XML mô tả **toàn bộ phiên trình chiếu** (Media Presentation). Cấu trúc logic:

- **MPD**  
  - **Period** (thời đoạn logic của nội dung, ví dụ chapter, chương quảng cáo)  
    - **AdaptationSet** (nhóm các track có cùng semantics, ví dụ video, audio, subtitle)  
      - **Representation** (một cấu hình cụ thể: codec, resolution, bitrate…)  
        - **Segment** (chuỗi các phân đoạn thời gian)

Ký hiệu:

- $P_i$: Period thứ $i$, kéo dài $T_{P_i}$ giây;  
- $A_{i,j}$: AdaptationSet $j$ trong Period $i$;  
- $R_{i,j,m}$: Representation $m$ trong AdaptationSet $A_{i,j}$.

Tổng thời lượng presentation:

$$
T_{\text{MPD}} = \sum_{i} T_{P_i}
$$

Mỗi $R_{i,j,m}$ chứa:

- thông tin codec (H.264, H.265, AV1), profile, level;  
- bitrate danh nghĩa $R_{\text{nom}}$;  
- resolution, framerate;  
- mô tả cách truy cập segment (SegmentBase, SegmentList, SegmentTemplate,…).

#### B.5.1.4. Mô hình segment và mapping thời gian

Trong DASH, các segment thường có độ dài gần như cố định $T_{\text{seg}}$ (ví dụ 2 s, 4 s). Với Representation $R$ có index segment $k = 0,1,\dots$, thời gian bắt đầu và kết thúc:

- thời gian bắt đầu (presentation time):

  $$
  t_k^{\text{start}} = t_0 + k \cdot T_{\text{seg}}
  $$

- thời gian kết thúc:

  $$
  t_k^{\text{end}} = t_0 + (k+1) \cdot T_{\text{seg}}
  $$

với $t_0$ là thời điểm bắt đầu Period (hoặc presentation).

**SegmentTemplate** trong MPD cho phép biểu diễn URL segment dưới dạng mẫu, ví dụ:

```xml
<SegmentTemplate
    media="video_$Number$.m4s"
    initialization="video_init.mp4"
    timescale="1"
    duration="4"/>
```

Ở đây:

* biến $Number$ trong URL tương ứng index $k$;
* $duration$ (đơn vị timescale) tương ứng $T_{\text{seg}}$.

DASH cũng hỗ trợ **segment of variable duration** thông qua `SegmentTimeline`, trong đó mỗi phần tử `S` có:

* `t` – thời điểm bắt đầu;
* `d` – duration;
* `r` – số lần lặp.

#### B.5.1.5. Profile và các extension

ISO/IEC 23009-1 định nghĩa nhiều **profile** (ví dụ `live`, `on-demand`) và hỗ trợ nhiều container (ISOBMFF, MPEG-2 TS). Tuy nhiên, trong thực tế, cộng đồng công nghiệp thường tuân theo các **Interoperability Points (IOPs)** do DASH-IF định nghĩa (B.5.4).

Key points:

* DASH bản thân là **chuẩn rất linh hoạt**, cho phép nhiều cách biểu diễn;
* Nếu không có profile chuẩn hóa, các implementation có thể không tương thích;
* Do đó, **DASH-IF IOP** (và sau này là **CMAF-based profiles**) là lớp “ràng buộc” thực tiễn.

---

### B.5.2. HTTP Live Streaming (HLS – RFC 8216)

#### B.5.2.1. Khái quát HLS

**HTTP Live Streaming (HLS)** là giao thức streaming thích ứng do Apple phát triển, lần đầu giới thiệu năm 2009, và được IETF chuẩn hóa trong **RFC 8216** [B34–B36]. HLS hoạt động theo cơ chế:

* chia nội dung media thành các **segment nhỏ** (thường 2–6 s);
* sử dụng **playlist** dạng **M3U8** để mô tả các segment;
* client tải lần lượt playlist và segment qua HTTP;
* hỗ trợ nhiều mức bitrate (adaptive bitrate) tương tự DASH.

Các đặc trưng chính:

* Dựa trên **HTTP** → tận dụng hạ tầng web/CDN;
* Hỗ trợ **live** và **VoD**;
* Hỗ trợ **encryption**, **DRM**, **audio multiple**, **subtitles**, **ad insertion**;
* Giao thức chính cho hệ sinh thái Apple (iOS, tvOS, Safari), nhưng hiện được hỗ trợ rộng rãi trên nhiều nền tảng.

RFC 8216 mô tả phiên bản chuẩn (protocol version 7); các bản cập nhật (HLS 2nd Edition, draft `hls-rfc8216bis`) mở rộng thêm nhiều tính năng (Low-Latency HLS, CMAF…) [B35].

#### B.5.2.2. Multivariant Playlist và Media Playlist

HLS sử dụng hai loại playlist chính:

* **Multivariant playlist** (còn gọi là master playlist): liệt kê các **variant stream** (mỗi variant là một bitrate/codec/resolution khác nhau).
* **Media playlist**: liệt kê các segment cụ thể cho từng variant.

Ví dụ simplified master playlist:

```m3u8
#EXTM3U
#EXT-X-STREAM-INF:BANDWIDTH=800000,RESOLUTION=640x360
low/index.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=1600000,RESOLUTION=1280x720
mid/index.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=3200000,RESOLUTION=1920x1080
high/index.m3u8
```

Ở đây:

* mỗi dòng `#EXT-X-STREAM-INF` mô tả một **variant** với bitrate danh nghĩa $R_{\text{nom}}$ (`BANDWIDTH`) và resolution;
* player chọn URL media playlist tương ứng (vd. `mid/index.m3u8`) dựa trên ước lượng throughput $ \hat{C} $ và chính sách ABR.

Media playlist (cho một variant) gồm danh sách segment:

```m3u8
#EXTM3U
#EXT-X-TARGETDURATION:4
#EXT-X-MEDIA-SEQUENCE:100
#EXTINF:4.000,
fileSequence100.ts
#EXTINF:4.000,
fileSequence101.ts
#EXTINF:4.000,
fileSequence102.ts
...
```

* $T_{\text{seg}}$ được chỉ ra bởi `#EXT-X-TARGETDURATION` và `#EXTINF` (duration từng segment);
* `#EXT-X-MEDIA-SEQUENCE` cho biết sequence number khởi đầu.

#### B.5.2.3. Định dạng segment: MPEG-2 TS, fMP4 (CMAF)

Ban đầu HLS sử dụng **MPEG-2 Transport Stream (.ts)** làm container segment. Về sau, HLS hỗ trợ **fMP4 (fragmented MP4)** thông qua **CMAF** (xem B.5.3), cho phép:

* chia sẻ cùng một file segment giữa HLS và DASH;
* giảm overhead so với TS;
* hỗ trợ tốt hơn cho low-latency do fMP4 + chunked transfer.

Gọi:

* $T_{\text{seg}}$: độ dài mục tiêu;
* $d_k$: duration thực tế của segment thứ $k$;
* playlist đảm bảo:

  $$
  \max_k d_k \le T_{\text{seg}}
  $$

nhằm thỏa điều kiện trong RFC 8216 về `TARGETDURATION`.

#### B.5.2.4. HLS và Low-Latency

Apple giới thiệu **Low-Latency HLS (LL-HLS)**, sử dụng:

* **partial segments** (các phần nhỏ hơn của segment, thường vài trăm ms);
* **preload hints** và **blocking playlist reload**;
* **HTTP/2 push** hoặc **HTTP/1.1 chunked transfer encoding**.

Với LL-HLS, độ trễ end-to-end $T_{\text{E2E}}$ có thể giảm xuống ~2–3 s, thậm chí ~1–2 s trong cấu hình tối ưu, thay vì 10–30 s như HLS truyền thống. Khái quát:

* nếu mỗi segment dài $T_{\text{seg}}$ và được chia thành $n$ partial segments, mỗi partial dài $T_{\text{part}} = T_{\text{seg}}/n$;
* client có thể bắt đầu tải và phát khi có đủ một vài partial → giảm $T_{\text{client-buf}}$.

Các chi tiết LL-HLS sẽ được phân tích sâu hơn trong mục C.2.3.

---

### B.5.3. CMAF (ISO/IEC 23000-19)

#### B.5.3.1. Khái quát CMAF

**Common Media Application Format (CMAF)** là chuẩn ISO/IEC 23000-19 trong họ MPEG-A, định nghĩa một **định dạng multimedia chung cho segmented media** [B37–B39]. Bản mới nhất:

* **ISO/IEC 23000-19:2024** – thay thế phiên bản 2018 [B37, B38].
* Có bổ sung **Amendment 1: LCEVC và các công nghệ khác** [B39].

Mục tiêu CMAF:

* xác định **track format** dựa trên **ISO Base Media File Format (ISOBMFF)**;
* định nghĩa **CMAF Track**, **CMAF Fragment**, **CMAF Chunk** có thể dùng chung cho nhiều giao thức (DASH, HLS…);
* hỗ trợ **seamless switching** giữa các bitrate/resolution khác nhau của cùng nội dung.

#### B.5.3.2. Khái niệm CMAF Track, Fragment, Chunk

Các khái niệm chính:

* **CMAF Track**: một chuỗi bộ dữ liệu encoded của một thành phần (ví dụ video H.264/AVC, HEVC, AAC audio…), được gói trong ISOBMFF với cấu trúc box cụ thể (moov, moof, mdat…).
* **CMAF Fragment**: một phần liên tục theo thời gian của track, chứa một hoặc nhiều **Movie Fragment Box (moof)** và **Media Data Box (mdat)**. Fragment thường tương ứng với một **segment** trong streaming.
* **CMAF Chunk**: phần còn nhỏ hơn của fragment, cho phép phát **low-latency** khi kết hợp với chunked transfer.

Gọi:

* $T_{\text{frag}}$: duration của một fragment;
* $T_{\text{chunk}}$: duration của một chunk;
* mỗi fragment có thể chia thành $n$ chunk, $T_{\text{chunk}} = T_{\text{frag}}/n$.

CMAF đặt ràng buộc về:

* **sample grouping**, **timescale**, **alignment** giữa các track;
* đảm bảo rằng các fragment trong các bitrate khác nhau có **cùng ranh giới thời gian**, cho phép **switch bitrate** mà không gây gián đoạn.

#### B.5.3.3. Interoperability DASH–HLS nhờ CMAF

Một trong các động lực chính của CMAF là cho phép **một bộ file segment fMP4 dùng chung** cho:

* **MPEG-DASH** (MPD tham chiếu các fragment/segment này);
* **HLS** (playlist M3U8 tham chiếu cùng file CMAF, gọi là CMAF Presentation trong tài liệu Apple [B40]).

Mô hình: thay vì tạo 2 bản copy (một cho DASH, một cho HLS) với cấu trúc đóng gói khác nhau, CMAF cho phép:

* encode → package thành **CMAF Track/Fragment**;
* DASH dùng MPD + URL trỏ đến file `.cmfv`, `.cmfa`, `.m4s`;
* HLS dùng M3U8 + URL trỏ đến cùng file.

Giả sử một asset có $M$ bitrate, mỗi bitrate trước đây tạo hai bản segment (TS cho HLS, fMP4 cho DASH). Số file tổng:

* Trước CMAF: $N_{\text{file,old}} \propto 2 \cdot M \cdot N_{\text{seg}}$;
* Với CMAF: $N_{\text{file,new}} \propto 1 \cdot M \cdot N_{\text{seg}}$.

Tiết kiệm:

$$
\frac{N_{\text{file,old}} - N_{\text{file,new}}}{N_{\text{file,old}}}
\approx \frac{2MN_{\text{seg}} - MN_{\text{seg}}}{2MN_{\text{seg}}}
= \frac{1}{2}
$$

tức là **giảm khoảng 50%** số file/không gian lưu trữ (xét riêng khía cạnh container), giảm phức tạp packager và caching.

---

### B.5.4. DASH-IF và Apple HLS Guidelines

#### B.5.4.1. DASH-IF Interoperability Guidelines

**DASH Industry Forum (DASH-IF)** là consortium công nghiệp thúc đẩy việc triển khai và tương tác của MPEG-DASH. Tài liệu quan trọng:

* **DASH-IF Interoperability Points (IOP)**, hiện mới nhất là **IOP V5.x** [B41–B43].

Các IOP guidelines:

* xác định **profile** và **constraint** cụ thể cho DASH dựa trên ISO/IEC 23009-1;
* định nghĩa cách sử dụng **H.264/AVC, H.265/HEVC, CMAF** trong bối cảnh OTT;
* chuẩn hóa các tính năng như **live, on-demand, ad insertion, trick modes, subtitles, encryption/DRM**;
* mô tả **reference architecture** cho dịch vụ DASH OTT (client, packager, CDN, DRM, ad server,…).

DASH-IF IOP V5 có cấu trúc nhiều phần (Part 1, Part 2, …), mỗi phần tập trung vào:

* kiến trúc & giới thiệu;
* media profile & codec;
* encryption & key management (CENC, DRM);
* low-latency DASH;
* test & conformance.

Trong thực tế, nhiều nền tảng streaming và packager tuân thủ **DASH-IF IOP** để đảm bảo compatibility giữa player/vendor khác nhau.

#### B.5.4.2. Apple HLS Authoring/Playback Guidelines

Apple duy trì một tập hợp tài liệu kỹ thuật bao gồm:

* **HLS Authoring Specification for Apple Devices**;
* **About the Common Media Application Format with HLS**;
* Các section trong **Apple Developer Documentation** về HLS, LL-HLS, CMAF [B40, B44].

Các guidelines này định nghĩa:

* cấu hình H.264/HEVC/AV1 được khuyến nghị (profile, level, GOP size, keyframe interval);
* cấu trúc playlist (các tag bắt buộc như `EXT-X-TARGETDURATION`, `EXT-X-VERSION`, `EXT-X-MAP`, `EXT-X-PART`,…);
* sử dụng CMAF: **CMAF Presentation**, **multivariant playlist** và **media playlist**;
* các yêu cầu cho **FairPlay Streaming**, caption/subtitles, audio grouping.

Ví dụ, Apple khuyến nghị:

* độ dài segment $T_{\text{seg}}$ khoảng 2–6 s với HLS truyền thống;
* với LL-HLS, $T_{\text{seg}}$ có thể dài hơn nhưng chia thành các **partial segment** dài $T_{\text{part}}$ ≈ 200–500 ms;
* GOP phải **aligned với boundary của segment** (keyframe tại đầu segment) để đảm bảo khả năng seek và switch bitrate.

#### B.5.4.3. Vai trò của các guidelines trong thực tiễn

Kết hợp lại:

* MPEG-DASH và HLS cung cấp **cú pháp và semantics chuẩn hóa**;
* CMAF cung cấp **định dạng media chung**;
* DASH-IF IOP và Apple HLS Guidelines cung cấp **profile, constraint, best practice**.

Điều này giúp:

1. **Đảm bảo tương thích (interoperability)**

   * Player từ vendor A có thể phát nội dung được packager của vendor B tạo;
   * CDN từ vendor C có thể cache và phân phối nội dung một cách hiệu quả.

2. **Đảm bảo QoE**

   * Điều chỉnh các tham số như $T_{\text{seg}}$, $T_{\text{part}}$, GOP, bitrate ladder theo khuyến nghị để tránh các cấu hình “lệch chuẩn” gây stall, startup delay dài, switching xấu.

3. **Giảm chi phí triển khai**

   * Reuse **CMAF segment** cho cả DASH và HLS;
   * Tuân theo profile chung để giảm debug tương thích giữa thiết bị khác nhau.

Trong các phần sau (C.2, D.3, D.5, E.2), project sẽ sử dụng chính **MPEG-DASH, HLS, CMAF, DASH-IF IOP, Apple HLS Authoring Guidelines** làm khung chuẩn cho thiết kế hệ thống và mô phỏng.

---

### Tài liệu tham khảo cho mục B.5 (định dạng IEEE)

[B31] ISO/IEC, *Information Technology — Dynamic Adaptive Streaming over HTTP (DASH) — Part 1: Media Presentation Description and Segment Formats*, ISO/IEC 23009-1:2022.

[B32] ISO/IEC, *Information Technology — Dynamic Adaptive Streaming over HTTP (DASH) — Part 1: Media Presentation Description and Segment Formats*, ISO/IEC 23009-1:2019.

[B33] MPEG, “MPEG-DASH (ISO/IEC 23009): Standards overview,” MPEG Official Webpage, 2024.

[B34] R. Pantos and W. May, “HTTP Live Streaming,” RFC 8216, IETF, Aug. 2017.

[B35] R. Pantos *et al.*, “HTTP Live Streaming 2nd Edition,” IETF Internet-Draft draft-pantos-hls-rfc8216bis-16, Nov. 2024.

[B36] “HTTP Live Streaming,” Apple Developer Documentation, 2023.

[B37] ISO/IEC, *Information Technology — Multimedia Application Format (MPEG-A) — Part 19: Common Media Application Format (CMAF) for Segmented Media*, ISO/IEC 23000-19:2018.

[B38] ISO/IEC, *Information Technology — Multimedia Application Format (MPEG-A) — Part 19: Common Media Application Format (CMAF) for Segmented Media*, ISO/IEC 23000-19:2024.

[B39] ISO/IEC, *Information Technology — Multimedia Application Format (MPEG-A) — Part 19: Common Media Application Format (CMAF) for Segmented Media — Amendment 1: Low Complexity Enhancement Video Coding (LCEVC) and Other Technologies*, ISO/IEC 23000-19:2024/Amd 1:2024.

[B40] Apple Inc., “About the Common Media Application Format with HTTP Live Streaming (HLS),” Apple Developer Documentation, 2023.

[B41] DASH-IF, *DASH-IF Interoperability Points V4.3*, DASH Industry Forum, 2020.

[B42] DASH-IF, *DASH-IF Interoperability Points V5.0 — Part 1: Overview and Architecture*, DASH Industry Forum, 2024.

[B43] DASH-IF, “DASH-IF Interoperability Guidelines,” Streaming Video Technology Alliance (SVTA) University, 2025.

[B44] Apple Inc., *HLS Authoring Specification for Apple Devices*, Apple Technical Note, 2023.


