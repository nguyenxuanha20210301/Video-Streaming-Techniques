## C.1. Progressive Download

Progressive download là kỹ thuật truyền video qua HTTP trong đó **toàn bộ file video** được server cung cấp như một đối tượng tĩnh (thường là `.mp4`), client **tải tuyến tính từ đầu đến cuối** bằng một hoặc vài request HTTP, đồng thời **bắt đầu phát khi đã buffer đủ một ngưỡng tối thiểu**. Khác với adaptive streaming (DASH/HLS), progressive download **không có manifest**, **không chia nhỏ thành segment logic**, và **không có cơ chế chọn bitrate động** dựa trên mạng \[C1], \[C2].

---

### C.1.1. Kiến trúc và nguyên lý hoạt động

#### C.1.1.1. Kiến trúc tổng quát

Trong mô hình progressive download cơ bản:

- Server chỉ là **web server/HTTP server** phục vụ file video (thường là MP4 theo ISO/IEC 14496-12/14).  
- Client (trình duyệt/native player):

  1. Gửi HTTP `GET` tới URL video;  
  2. Nhận luồng byte file video;  
  3. Khi đã tải đủ dữ liệu cho một số giây phát, bắt đầu decode và play;  
  4. Tiếp tục tải phần còn lại trong nền.

Sơ đồ ASCII:

```text
          +----------------------+
          |   HTTP Web Server    |
          |  (video.mp4 static)  |
          +----------+-----------+
                     |
        -------------+---------------- Internet --------------
                     |
             HTTP GET /video.mp4
                     |
                +----+----------------------+
                |     Video Client          |
                | (Browser/Native Player)   |
                +---------------------------+
             - Tải tuyến tính file .mp4
             - Buffer nội bộ
             - Phát khi đủ dữ liệu
```

Các đặc điểm chính:

* File video được đóng gói **theo chuẩn container** (MP4/FLV/3GP, v.v.) với **moov box** chứa metadata ở đầu hoặc đầu stream để cho phép **progressive playback** [C3].
* HTTP/1.1 hỗ trợ **range request** cho phép seek đến vị trí bất kỳ trong file mà không cần tải từ đầu.

#### C.1.1.2. So sánh với “true streaming” và HTTP adaptive streaming

* So với **RTSP/RTP streaming**:

  * Progressive download không có session state tại server (server không “stream” frame theo thời gian thực).
  * Không có control channel (PLAY, PAUSE, TEARDOWN), tất cả điều khiển do client thực hiện cục bộ (pause, seek bằng thao tác buffer/local file).

* So với **HTTP adaptive streaming (DASH/HLS)**:

  * Progressive: **một file duy nhất** ở một bitrate cố định $R_{\text{enc}}$.
  * DASH/HLS: nhiều representation với bitrate khác nhau; client chọn segment ở bitrate phù hợp $R_k$ dựa trên throughput ước lượng $\hat{C}_k$ và state buffer.
  * Progressive có thể gây **stall** nếu throughput giảm dưới $R_{\text{enc}}$ và không có cơ chế giảm bitrate.

Progressive download do đó phù hợp với môi trường:

* throughput tương đối **ổn định**, lớn hơn bitrate video;
* yêu cầu kỹ thuật đơn giản (upload file lên web server/CDN là có thể phát được);
* không cần tối ưu QoE phức tạp.

---

### C.1.2. Mô hình tải tuyến tính

Giả sử ta có:

* $S$: kích thước file video (bit);

* $T_{\text{video}}$: thời lượng video (s);

* $R_{\text{enc}}$: bitrate mã hóa danh nghĩa của video (bit/s), xấp xỉ:

  $$
  R_{\text{enc}} \approx \frac{S}{T_{\text{video}}}
  $$

* $C(t)$: throughput thực tế tại thời điểm $t$ (bit/s);

* $A(t)$: tổng số bit đã tải được đến thời điểm $t$ (bit).

Với mô hình fluid liên tục, ta có:

$$
A(t) = \int_{0}^{t} C(\tau), d\tau,\quad 0 \le A(t) \le S
$$

Nếu chỉ xét giai đoạn **chưa tải xong file**, và bỏ qua overhead, tốc độ tiêu thụ video về mặt bit là:

$$
R_{\text{play}}(t) = R_{\text{enc}} \quad \text{khi playback đang chạy}
$$

**Buffer theo đơn vị bit** tại thời điểm $t$, ký hiệu $B_{\text{bit}}(t)$:

$$
B_{\text{bit}}(t) = A(t) - R_{\text{enc}} \cdot t
$$

* Nếu $B_{\text{bit}}(t) > 0$: có sẵn dữ liệu trong buffer để play;
* Nếu $B_{\text{bit}}(t) = 0$ và $C(t) < R_{\text{enc}}$: playback bị dừng/stall.

Thường ta làm việc với **buffer theo đơn vị giây phát**, ký hiệu $B(t)$:

$$
B(t) = \frac{A(t)}{R_{\text{enc}}} - t
$$

($B(t)$ là “số giây video còn lại trong buffer” nếu playback đang chạy).

Ta có:

* $B(t) > 0$: buffer đủ, playback mượt;
* $B(t) = 0$: buffer cạn, playback dừng.

---

### C.1.3. Ước lượng throughput và tốc độ tải trong progressive download

Mặc dù progressive download **không thích ứng bitrate**, ta vẫn có thể (và nên) ước lượng **throughput thực tế** để:

* hiển thị tiến trình tải (ví dụ % download);
* quyết định threshold buffer khi start;
* trong một số ứng dụng, sử dụng kết quả đo này làm input cho **adaptive bitrate prefetching** (pseudo-ABR).

Xét khoảng thời gian $\Delta t$ mà trong đó client quan sát được dữ liệu tăng $\Delta A$ (bit). Throughput mẫu:

$$
C_{\text{sample}} = \frac{\Delta A}{\Delta t}
$$

Đối với progressive download, một cách tự nhiên là đo trên **toàn bộ file**:

* Thời gian hoàn tất download: $T_{\text{dl}}$ (s).
* Throughput trung bình:

  $$
  C_{\text{avg}} = \frac{S}{T_{\text{dl}}}
  $$

Tuy nhiên, do điều kiện mạng có thể thay đổi theo thời gian, ta có thể đo **theo cửa sổ trượt**:

* Chia quá trình tải thành các khoảng nhỏ $\Delta t$ (ví dụ 1 s).
* Với mỗi khoảng thứ $n$, đo $C_n = \frac{\Delta A_n}{\Delta t}$.
* Sinh ra dãy ${C_n}$ dùng để:

  * đánh giá khả năng stall trong tương lai;
  * log QoE, chẩn đoán mạng.

Nếu gọi $\hat{C}_n$ là throughput trung bình trơn, ta có:

$$
\hat{C}*n
= (1 - \alpha)\hat{C}*{n-1} + \alpha C_n,\quad 0 < \alpha \le 1
$$

Trong progressive download **standard**, $\hat{C}_n$ thường không được dùng để thay đổi bitrate (vì chỉ có một file duy nhất), nhưng nó có thể ảnh hưởng đến:

* quyết định **tạm dừng prebuffer** nếu người dùng seek tới cuối;
* hoặc trong các player thông minh, dùng để quyết định **chất lượng video cho các request tiếp theo** (nếu app có nhiều URL với bitrate khác nhau, nhưng vẫn “giả vờ” progressive).

---

### C.1.4. Mô hình độ trễ khởi tạo (startup delay)

Trong progressive download, **startup delay** $T_{\text{startup}}$ chủ yếu phụ thuộc vào:

1. Thời gian **thiết lập kết nối HTTP/TCP/TLS**, ký hiệu $T_{\text{ctrl}}$;
2. Thời gian **download lượng dữ liệu ban đầu** cần thiết để tránh stall sớm, ký hiệu $T_{\text{buf}}$.

Ta có thể xấp xỉ:

$$
T_{\text{startup}} \approx T_{\text{ctrl}} + T_{\text{buf}}
$$

#### C.1.4.1. Buffer khởi tạo theo giây playback

Giả sử player muốn buffer ban đầu là $B_{\text{start}}$ (giây video). Khi đó, phải tải ít nhất:

$$
S_{\text{start}} = R_{\text{enc}} \cdot B_{\text{start}}\ \text{(bit)}
$$

Nếu throughput hiệu dụng trong giai đoạn start là $C_{\text{eff}}$ (bit/s), thời gian để tải đủ phần này:

$$
T_{\text{buf}} = \frac{S_{\text{start}}}{C_{\text{eff}}}
= \frac{R_{\text{enc}} \cdot B_{\text{start}}}{C_{\text{eff}}}
$$

* Nếu $C_{\text{eff}} \gg R_{\text{enc}}$: $T_{\text{buf}}$ nhỏ → startup nhanh.
* Nếu $C_{\text{eff}}$ chỉ hơi lớn hơn $R_{\text{enc}}$: $T_{\text{buf}}$ lớn → startup delay tăng.

Ví dụ:

* $R_{\text{enc}} = 3\ \text{Mbit/s}$, $B_{\text{start}} = 5\ \text{s}$, $C_{\text{eff}} = 10\ \text{Mbit/s}$:

  $$
  T_{\text{buf}} = \frac{3 \cdot 5}{10} = 1.5\ \text{s}
  $$

* Nếu $C_{\text{eff}}$ giảm còn $4\ \text{Mbit/s}$:

  $$
  T_{\text{buf}} = \frac{3 \cdot 5}{4} = 3.75\ \text{s}
  $$

→ Startup delay tăng đáng kể.

#### C.1.4.2. Điều kiện tránh stall trong suốt phiên

Để **không xảy ra stall** trong toàn bộ quá trình xem, cần đảm bảo **cho mọi $t$ từ khi bắt đầu playback đến khi kết thúc video**:

$$
B(t) = \frac{A(t)}{R_{\text{enc}}} - t \ge 0
$$

Trong trường hợp **throughput không đổi** $C(t) = C$ và bỏ qua thời gian control, nếu playback bắt đầu tại $t = T_{\text{startup}}$ với buffer $B_{\text{start}}$, sau đó:

* Trong pha đầu (trước khi tải xong file):

  $$
  A(t) = C \cdot t,\quad
  B(t) = \frac{C \cdot t}{R_{\text{enc}}} - t = t \left( \frac{C}{R_{\text{enc}}} - 1 \right)
  $$

* Nếu $C \ge R_{\text{enc}}$: hệ số $\left(\frac{C}{R_{\text{enc}}} - 1\right) \ge 0$, buffer không giảm, **không stall** (sau khi đã start).

* Nếu $C < R_{\text{enc}}$: buffer **giảm tuyến tính** theo thời gian và sẽ chạm 0 sau khoảng:

  $$
  T_{\text{stall}} \approx \frac{B_{\text{start}}}{1 - \frac{C}{R_{\text{enc}}}}
  $$

Như vậy, chỉ với progressive download và bitrate cố định:

* **điều kiện lý tưởng để không stall**: $C \ge R_{\text{enc}}$ trong toàn bộ thời gian;
* với mạng biến đổi (typical Internet), điều kiện này hiếm khi giữ được → progressive dễ bị stall khi băng thông tụt.

Điểm này là động lực chính dẫn tới sự phát triển của **adaptive streaming (ABR)**.

---

### C.1.5. Ưu điểm, nhược điểm và giới hạn của Progressive Download

#### C.1.5.1. Ưu điểm

1. **Đơn giản về triển khai**

   * Chỉ cần **upload video file** lên bất kỳ web server/CDN nào;
   * Không cần packager DASH/HLS, không cần MPD/playlist;
   * Client chỉ cần khả năng đọc container (MP4/FLV) và decode codec tương ứng.

2. **Tận dụng tốt HTTP/CDN hiện có**

   * Progressive download hoạt động tốt với **HTTP caching**, **reverse proxy** và **CDN** (cache cả file video).
   * Dễ dùng các cơ chế bảo mật HTTPS/TLS, cookies, auth như trang web thông thường.

3. **Hỗ trợ seek đơn giản (với Range requests)**

   * HTTP `Range` cho phép client yêu cầu phần cuối của file khi người dùng seek;
   * Không yêu cầu server giữ state streaming.

4. **Phù hợp với nội dung ngắn, throughput ổn định**

   * Clip ngắn, video quảng cáo, file tải xuống để xem offline;
   * Môi trường băng thông “dư dả” (LAN, campus network).

#### C.1.5.2. Nhược điểm

1. **Không thích ứng bitrate theo mạng**

   * Khi điều kiện mạng suy giảm (ví dụ người dùng di chuyển từ Wi-Fi sang 3G), **không có cách giảm chất lượng** để tránh stall;
   * HOẶC phải stop playback, giảm chất lượng bằng cách **reload lại từ đầu** một file khác bitrate – gây trải nghiệm rất tệ.

2. **Lãng phí băng thông khi người dùng dừng giữa chừng**

   * Progressive download tiếp tục tải file ngay cả khi người dùng có thể chỉ xem vài phút đầu.

   * Nếu user dừng tại $t_{\text{stop}} < T_{\text{video}}$ nhưng đã tải phần lớn file, lượng dữ liệu tải thừa là:

     $$
     S_{\text{waste}} \approx S - R_{\text{enc}} \cdot t_{\text{stop}}
     $$

   * Với ABR segment-based, chỉ những segment đã thực sự được request mới tải.

3. **Khó kiểm soát QoE trên mạng di động/biến động**

   * Không thể tối ưu trade-off giữa bitrate/trễ/stall như trong ABR;
   * Dễ dẫn đến **stall dài** hoặc **buộc phải encode ở bitrate rất thấp** để “an toàn” → chất lượng hình ảnh tệ.

4. **Thiếu hỗ trợ native cho multi-track, multi-language, ad insertion phức tạp**

   * Mặc dù có thể embed nhiều track trong MP4, nhưng logic lựa chọn track/phối hợp quảng cáo, SSAI (server-side ad insertion) phức tạp hơn so với DASH/HLS (nơi manifest/playlist mô tả rõ ràng).

5. **Không phù hợp cho live streaming hiện đại**

   * Progressive download vốn dĩ là mô hình VoD (file finite).
   * Với live, cần stream unbounded content, phân đoạn thời gian thực và tối ưu low-latency → HD DASH/HLS LL-HLS/LL-DASH/WebRTC là lựa chọn phù hợp hơn.

#### C.1.5.3. Vị trí của progressive download trong bối cảnh hiện đại

Trong bối cảnh OTT hiện nay:

* Progressive download chủ yếu xuất hiện trong:

  * **embed video đơn giản** trên website cũ;
  * **download-and-play** (người dùng tải file về để xem offline);
  * một số ứng dụng mobile đơn giản.

* Các dịch vụ lớn (Netflix, YouTube, Twitch, Disney+, v.v.) gần như đều dựa trên:

  * **HTTP adaptive streaming** (DASH/HLS/CMAF) cho VoD;
  * **Low-latency HLS/LL-DASH/WebRTC** cho live/interactive.

Tuy nhiên, progressive download vẫn là **mô hình khởi đầu “đơn giản nhất”** để sinh viên:

* hiểu mối quan hệ giữa bitrate–throughput–buffer;
* xây dựng các mô hình toán đầu tiên về **download vs playback**;
* từ đó mở rộng sang các kịch bản phức tạp hơn (ABR, live, low-latency).

---

### Tài liệu tham khảo cho mục C.1 (định dạng IEEE)

[C1] R. S. Begen, T. Akgul, and M. Baugher, “Watching video over the Web: Part 1: Streaming protocols,” *IEEE Internet Comput.*, vol. 15, no. 2, pp. 54–63, Mar.–Apr. 2011.

[C2] R. S. Begen, T. Akgul, and M. Baugher, “Watching video over the Web: Part 2: Applications, standards, and trends,” *IEEE Internet Comput.*, vol. 15, no. 3, pp. 59–63, May–Jun. 2011.

[C3] I. E. G. Richardson, *The H.264 Advanced Video Compression Standard*, 2nd ed., Wiley, 2010, ch. 11 (File Format and Progressive Download).

[C4] T. Stockhammer, “Dynamic adaptive streaming over HTTP – Standards and design principles,” in *Proc. ACM MMSys*, 2011, pp. 133–144.

[C5] S. Akhshabi, A. C. Begen, and C. Dovrolis, “An experimental evaluation of rate-adaptation algorithms in adaptive streaming over HTTP,” in *Proc. ACM MMSys*, 2011, pp. 157–168.

[C6] Cisco Systems, “Video on Demand: Streaming vs. Progressive Download,” Cisco Tech Note, 2012.

[C7] J. F. Kurose and K. W. Ross, *Computer Networking: A Top-Down Approach*, 8th ed., Pearson, 2021, ch. 7 (Multimedia Networking).

